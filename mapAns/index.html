<html>
<head>
  <meta charset="utf-8">
  <title>Map Answers</title>
</head>
<style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 20%;
  padding: 10px;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
</style>
<body>
<form name="pointform" method="post">
<div class="row">
  <div class="column">
  <input type="text" name="number" size="4" /><input type="button" onclick="SetUp()" value="Setup">
	<table id="resultTable" >
    </table>
<input type="button" onclick="Draw()" value="Plot">
<input type="button" onclick="Clear()" value="Clear">
<p id="winnerText"></p>
  </div>
  <div class="column">
    <p>
		<img id='theImg' src='map.jpg'>
		<canvas id='myCanvas' width='731px' height='724px'></canvas>
	</p>
  </div>
</div>

<br>


	
</body>

<script language="JavaScript" type="text/javascript">
	var myMap = new Map();

	function Draw(){
	  var img = document.getElementById("theImg");
	  var cnvs = document.getElementById("myCanvas");
	  
	  cnvs.style.position = "absolute";
	  cnvs.style.left = img.offsetLeft + "px";
	  cnvs.style.top = img.offsetTop + "px";
	  
	  console.log(img.offsetLeft +" "+img.offsetTop)
	  ans = document.pointform.ans.value
	  ansX = parseInt(ans.substring(0,2), 36);
	  ansY = parseInt(ans.substring(2,4), 36);
	  console.log(ansX + "," + ansY)
	  
	  var ctx = cnvs.getContext("2d");
	  ctx.clearRect(0, 0, cnvs.width, cnvs.height);
	  ctx.beginPath();
	  ctx.arc(ansX, ansY, 10, 0, 2 * Math.PI, false);
	  ctx.lineWidth = 3;
	  ctx.strokeStyle = '#00ff00';
	  ctx.fillStyle = '#00ff00'
	  ctx.fill();
	  
	  var rowNum = parseInt(document.pointform.number.value, 10);
	  var minDistance = 99999999999999999
	  var winner = "nobody"
	  for (var i = 1; i <=rowNum; i++){
		answerId = "ans" + i
		tempAns=document.pointform.elements[answerId].value
		console.log("ANS: "+ tempAns)
		tempAnsX = parseInt(tempAns.substring(0,2), 36);
	    tempAnsY = parseInt(tempAns.substring(2,4), 36);
		ctx.beginPath();
	    ctx.arc(tempAnsX, tempAnsY, 10, 0, 2 * Math.PI, false);
	    ctx.lineWidth = 3;
	    ctx.fillStyle = myMap.get(i-1); 
	    ctx.fill();
		
		var dist = Math.sqrt( Math.pow((ansX-tempAnsX), 2) + Math.pow((ansY-tempAnsY), 2) );
		if (dist < minDistance) {
			answerId = "name" + i
			winner = document.pointform.elements[answerId].value
			minDistance = dist
		}
	  }
	  document.getElementById("winnerText").innerHTML = "Winner is " + winner;
	}
	
	function Clear(){
		var cnvs = document.getElementById("myCanvas");
		var ctx = cnvs.getContext("2d");
		document.pointform.ans.value = ""
		var rowNum = parseInt(document.pointform.number.value, 10);
		for (var i = 1; i <=rowNum; i++){
			answerId = "ans" + i
			document.pointform.elements[answerId].value = ""
		}
		 document.getElementById("winnerText").innerHTML = "";
	}
	
	function getRandomColor() {
	  var letters = '0123456789ABCDEF';
	  var color = '#';
	  for (var i = 0; i < 6; i++) {
		color += letters[Math.floor(Math.random() * 16)];
	  }
	  console.log(color)
	  return color;
	}
	
	function SetUp(){
		var table = document.getElementById("resultTable")
		var rowNum = parseInt(document.pointform.number.value, 10);
		var resultHtml = '<tr><td></td><td>Answer</td><td><input type="text" name="ans" size="4" /></td>';
		
		for(var i = 0 ; i < rowNum ; i++) {
			color = getRandomColor()
			myMap.set(i, color);
			resultHtml += ["<tr style=background-color:"+color+">", 
		 "<td>", 
		  (i+1),
		 "</td>",
		 '<td><input type="name" name="name'+(i+1)+'" placeholder="Name"></td>',
		 '<td><input type="name" name="ans'+(i+1)+'" placeholder="Answer"></td>',
		 '</tr>'].join("\n");
		}  
		
		table.innerHTML = resultHtml;
		return false; 
	}
</script>

</html>